<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Predictions</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
    body { font-family: "Poppins", sans-serif; background: #f3eaff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
    
    .sidebar { width: 260px; background: #1e1e2d; color: #fff; display: flex; flex-direction: column; padding: 20px; }
    .logo { font-size: 22px; margin-bottom: 40px; color: #fff; font-weight: bold; }
    .nav-item { padding: 15px; border-radius: 10px; cursor: pointer; color: #a2a3b7; display: flex; gap: 15px; transition: 0.3s; margin-bottom: 5px; }
    .nav-item:hover, .nav-item.active { background: #1b1b28; color: #3699ff; }
    
    .main { flex: 1; padding: 30px; overflow-y: auto; }
    .filter-bar { background: white; padding: 15px; border-radius: 10px; display: flex; gap: 15px; margin-bottom: 25px; }
    .search-box { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
    
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 10px; overflow: hidden; }
    th { text-align: left; padding: 15px; background: #f8f9fa; color: #666; }
    td { padding: 15px; border-bottom: 1px solid #eee; }
    .badge { padding: 5px 10px; border-radius: 6px; font-size: 12px; font-weight: bold; }
    .badge-high { background: #c9f7f5; color: #1bc5bd; } .badge-low { background: #ffe2e5; color: #f64e60; }
</style>
</head>
<body>

<div class="sidebar">
    <div class="logo"><i class="fa-solid fa-shield-halved"></i> Edu2Job Admin</div>
    <div class="nav-item" onclick="location.href='admin_home.html'"><i class="fa-solid fa-chart-pie"></i> Dashboard</div>
    <div class="nav-item active"><i class="fa-solid fa-table"></i> Predictions</div>
    <div class="nav-item" onclick="location.href='admin.html'"><i class="fa-solid fa-gears"></i> Settings & Logs</div>
    <div class="nav-item" onclick="logout()" style="margin-top:auto;"><i class="fa-solid fa-right-from-bracket"></i> Logout</div>
</div>

<div class="main">
    <div class="filter-bar">
        <input type="text" id="search" class="search-box" placeholder="Search User or Role..." onkeyup="filterData()">
        <select id="statusFilter" class="search-box" onchange="filterData()">
            <option value="all">All</option>
            <option value="flagged">Flagged Only</option>
        </select>
    </div>

    <table>
        <thead><tr><th>Date</th><th>User</th><th>Role</th><th>Confidence</th><th>Status</th></tr></thead>
        <tbody id="tableBody"></tbody>
    </table>
</div>

<script>
    const token = localStorage.getItem('access_token');
    if(!token) window.location.href="login.html";

    let allData = [];

    async function loadData() {
        const res = await fetch("http://127.0.0.1:5000/admin/logs", { headers: {'Authorization': 'Bearer '+token} });
        allData = await res.json();
        renderTable(allData);
    }

    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        data.forEach(item => {
            let confClass = parseFloat(item.confidence) > 80 ? 'badge-high' : 'badge-low';
            let status = item.flag === 'flagged' ? '<span class="badge badge-low">Flagged</span>' : '<span class="badge badge-high">Valid</span>';
            
            tbody.innerHTML += `<tr>
                <td>${item.date}</td>
                <td><b>${item.user}</b></td>
                <td>${item.role || '--'}</td>
                <td><span class="badge ${confClass}">${item.confidence}</span></td>
                <td>${status}</td>
            </tr>`;
        });
    }

    function filterData() {
        const search = document.getElementById('search').value.toLowerCase();
        const status = document.getElementById('statusFilter').value;
        
        const filtered = allData.filter(item => {
            const matchesSearch = item.user.toLowerCase().includes(search) || (item.role || "").toLowerCase().includes(search);
            const matchesStatus = status === 'all' || (status === 'flagged' && item.flag === 'flagged');
            return matchesSearch && matchesStatus;
        });
        renderTable(filtered);
    }

    function logout() { localStorage.removeItem('token'); window.location.href = 'login.html'; }
    loadData();
</script>
</body>
</html>