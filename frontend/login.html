<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Edu2Job | Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
  body {
    margin: 0;
    font-family: "Poppins", sans-serif;
    background: #f8f9ff;
    height: 100vh;
    display: flex;
  }

  .container {
    display: flex;
    width: 100%;
    height: 100vh;
  }

  .left {
    flex: 1;
    background: #5A23B5;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding-left: 60px;
  }

  .title {
    font-size: 44px;
    font-weight: 700;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 18px;
    opacity: 0.9;
  }

  .right {
    flex: 1;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 0 70px;
  }

  h2 {
    font-size: 32px;
    font-weight: 700;
    color: #4a148c;
    margin-bottom: 5px;
  }

  .muted {
    color: #666;
    margin-bottom: 25px;
  }

  .input-group {
    margin-bottom: 18px;
  }

  .input-group label {
    display: block;
    margin-bottom: 6px;
    font-size: 15px;
    font-weight: 600;
    color: #333;
  }

  .input-group input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 15px;
    outline: none;
  }

  .btn {
    width: 100%;
    padding: 12px;
    background: #7b2cbf;
    border: none;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    font-size: 17px;
    font-weight: 600;
    margin-top: 10px;
  }

  .google-wrapper {
    margin-top: 15px;
  }

  .link {
    margin-top: 18px;
    text-align: center;
    font-size: 14px;
  }

  .link a {
    color: #7b2cbf;
    text-decoration: none;
    font-weight: 600;
  }
</style>
</head>

<body>

<div class="container">

  <div class="left">
      <div class="title">Edu2Job</div>
      <div class="subtitle">Shape your career with AI</div>
  </div>

  <div class="right">
      <h2>Welcome Back</h2>
      <div class="muted">Login with your username & password</div>

      <form id="loginForm">
        <div class="input-group">
          <label>Username or Email</label>
          <input type="text" id="username" required>
        </div>

        <div class="input-group">
          <label>Password</label>
          <input type="password" id="password" required>
        </div>

        <button class="btn" type="submit">Login</button>

        <div class="google-wrapper">
          <div id="googleBtn"></div>
        </div>

        <div class="link">
          No account? <a href="signup.html">Create one</a>
        </div>
      </form>
  </div>

</div>

<script>
const API_BASE = "http://127.0.0.1:5000";

/* ðŸš€ HELPER: REDIRECT BASED ON ROLE */
function handleLoginSuccess(data) {
    // 1. Save Token
    localStorage.setItem("access_token", data.token); // Keep using "access_token" to match your app
    
    // 2. Check Role & Redirect
    console.log("Login Successful. Role:", data.role);
    
    if (data.role === "admin") {
        window.location.href = "admin_home.html";
    } else {
        window.location.href = "dashboard.html";
    }
}

/* ðŸŸ¢ NORMAL LOGIN */
document.getElementById("loginForm").addEventListener("submit", async (e)=> {
    e.preventDefault();

    const usernameInput = document.getElementById("username").value.trim();
    const passwordInput = document.getElementById("password").value;

    try {
        const res = await fetch(API_BASE + "/login", {
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            // Sending as 'username' to match your backend logic
            body: JSON.stringify({ username: usernameInput, password: passwordInput })
        });

        const data = await res.json();

        if(!res.ok){
            alert(data.error || "Login failed!");
            return;
        }

        // Handle success logic
        handleLoginSuccess(data);

    } catch (err) {
        console.error(err);
        alert("Network error. Is the backend running?");
    }
});

/* ðŸ”µ GOOGLE LOGIN */
function handleGoogle(response) {
    fetch(API_BASE + "/google-login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token: response.credential })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            alert(data.error);
            return;
        }

        // Save optional Google info
        if (data.picture) localStorage.setItem("google_picture", data.picture);
        if (data.name) localStorage.setItem("google_name", data.name);

        // Handle success logic
        handleLoginSuccess(data);
    })
    .catch(err => {
        console.error(err);
        alert("Google login failed");
    });
}

window.onload = function () {
    google.accounts.id.initialize({
        client_id: "983358026198-c1vfs6d2eclv3lfu4a3rdg6u3q3c72sk.apps.googleusercontent.com",
        callback: handleGoogle
    });

    google.accounts.id.renderButton(
        document.getElementById("googleBtn"),
        { theme: "outline", size: "large", width: 320 }
    );
};
</script>
</body>
</html>